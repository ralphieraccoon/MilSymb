% WARNING! Typesetting tables can cause memory overflow. Set --extra-mem-top=10000000 in Typesetting or texmf.cnf

\documentclass[a4paper, titlepage]{article}
\usepackage{milsymb, arev, ltablex, makecell, multirow, tikzpagenodes, vhistory, titlesec, float, forest, tocloft, alltt, array, tikz-dimline, threeparttable, textcomp}
\usepackage[a4paper, margin=1.75cm]{geometry}
\usepackage[colorlinks=true, urlcolor=blue]{hyperref}
\usetikzlibrary{calc, arrows.meta}
\newcolumntype{n}{>{\raggedright\arraybackslash}m{5cm}}
\newcolumntype{s}{>{\centering\arraybackslash}m{1.75cm}}
\newcommand\MilSymb{\textbf{\texttt{MilSymb}} }
\newcommand\DocLink{\href{https://www.awl.edu.pl/images/en/APP_6_C.pdf}{APP6-(C)} }
\renewcommand\theadfont{\bfseries}
\newenvironment{writett}{\ttfamily}{\par}
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4} 
\setlength{\cftsubsecnumwidth}{3em}
\setlength{\cftsubsubsecnumwidth}{4em}
\setlength{\cftparanumwidth}{5em}
\title{MilSymb}
\author{Damian Crosby}
\begin{document}
\thispagestyle{empty}
\begin{center}
\begin{tikzpicture}[remember picture]

\coordinate (NE) at ($(current page text area.north east)-(1.5, 1.5)$);
\coordinate (NW) at ($(current page text area.north west)-(-1.5, 1.5)$);
\coordinate (SE) at ($(current page text area.south east)-(1.5, -1.5)$);
\coordinate (SW) at ($(current page text area.south west)-(-1.5, -1.5)$);

\MilLand[faction=hostile, echelon=team, main=infantry, scale=2](NE)
\MilAir[faction=friendly, main=military fixed wing, upper=jammer, lower=light, scale=2](NW)
\MilSeaSurface[faction=neutral, main=hazardous material transport ship, lower=fast, scale=2](SE)
\MilActivity[faction=unknown, main=searching, upper=house to house, scale=2](SW)

\MilLand[faction=unknown, echelon=battalion, main=armoured, upper=missile, lower=long range, scale=2]($(NE)!0.33!(NW)$)
\MilEquipment[faction=neutral, main=heavy machine gun, mobility=pack animal, scale=2]($(NE)!0.66!(NW)$)

\MilSpace[faction=hostile, main=military earth observation satellite, upper=low earth orbit, lower=radar, scale=2]($(SE)!0.33!(SW)$)
\MilInstallation[faction=friendly, main=electric power, upper=nuclear energy, scale=2]($(SE)!0.66!(SW)$)

\MilSeaSubsurface[faction=friendly, main=snorkelling submarine, upper=auxiliary, lower=nuclear type 5, scale=2]($(NE)!0.2!(SE)$)
\MilLand[faction=neutral, echelon=platoon, main=supply, supply={2}{4}, scale=2]($(NE)!0.4!(SE)$)
\MilActivity[faction=hostile, main=attempted criminal activity, upper=rape, scale=2]($(NE)!0.6!(SE)$)
\MilEquipment[faction=unknown, main=tank recovery vehicle, mobility=wheeled semi trailer, scale=2]($(NE)!0.8!(SE)$)

\MilMissile[faction=hostile, left=sub surface, right=launched, scale=2]($(NW)!0.2!(SW)$)
\MilInstallation[faction=unknown, main=civilian telecommunications, upper=television, scale=2]($(NW)!0.4!(SW)$)
\MilSpace[faction=friendly, main=civilian space station, upper=geosynchronous orbit, scale=2]($(NW)!0.6!(SW)$)
\MilLand[faction=neutral, echelon=corps, main=armoured, upper=missile, lower=long range, scale=2]($(NW)!0.8!(SW)$)

\pgfresetboundingbox
\path[use as bounding box] (0,0);

\end{tikzpicture}

{\let\newpage\relax\maketitle}
\end{center}

\clearpage

\begin{versionhistory}
\renewcommand \vhAuthorColWidth{6cm}
\vhEntry{1.0}{22/01/2018}{Damian Crosby}{Creation}
\end{versionhistory}

\clearpage

\section*{Acknowledgments}

The author would particularly like to thank the following members of the \TeX\  stack exchange community for their solutions to problems during this package\rq{}s development:

\begin{itemize}
\item \href{https://tex.stackexchange.com/users/39222}{cfr}
\item \href{https://tex.stackexchange.com/users/9335}{Kpym}
\item \href{https://tex.stackexchange.com/users/586}{Torbj\o rn T.}
\item \href{https://tex.stackexchange.com/users/2388}{Ulrike Fischer}
\end{itemize}

\clearpage

\tableofcontents

\clearpage

\section{Introduction}

\subsection{Package Summary}

This package allows for the drawing of symbols from the NATO Joint Military Symbology library, as detailed in the document \DocLink. It is designed to replicate the \lq\lq{}building block\rq\rq{} nature of the symbols in its command syntax using \texttt{pgf} keys, allowing the user to generate the entire symbol, including additional text fields, in one compact command.

\subsection{Package Dependencies}

The \MilSymb package uses the following packages as dependancies:

\begin{itemize}
\item \texttt{tikz}
\item \texttt{fontenc}
\item \texttt{fix-cm}
\item \texttt{arevmath}
\item \texttt{marvosym}
\item \texttt{acronym}
\item \texttt{amssymb}
\item \texttt{xifthen}
\item \texttt{xparse}
\end{itemize}

\subsection{Using \MilSymb}

To use \MilSymb in your document, just include \texttt{\textbackslash usepackage\{milsymb\}} in your preamble. \MilSymb has only been tested on \LaTeX, other \TeX\  flavours will probably not work. All \MilSymb symbols must be placed inside a TikZ environment, either as part of an inline \texttt{tikz} command or an \texttt{tikzpicture} enviroment. 

\subsubsection{Package Options}

\section{Symbol Commands}

\subsection{General Command Structure}

The general structure of a \MilSymb command is as follows. Syntax in \textit{italics} is optional:\\

\texttt{\textbackslash command[key, key=value]\textit{(location)(name)\{label\}}}

\begin{itemize}
\item \texttt{command} is the name of the command. All are prefixed with \texttt{Mil}-, and end with \texttt{Air}, \texttt{Missile}, \texttt{Land}, \texttt{Equipment}, \texttt{Installation}, \texttt{SeaSurface}, \texttt{SeaSubsurface}, \texttt{Mine}, \texttt{Space}, \texttt{Debris} and\\ \texttt{Activity}. These mostly correspond to the categories found in \DocLink, except for \texttt{Missile}, \texttt{Mine} and \texttt{Debris}, which have been broken off from \texttt{Air}, \texttt{SeaSubsurface} and \texttt{Space} for convenience. The \texttt{OwnShip} command is an exception to this rule, and does not have the \texttt{Mil}- prefix.

\item \texttt{key} and \texttt{key=value} are the options used to build the symbol, such as faction, icons, modifiers, and amplifiers. Keys with no value define boolean switches, such as \texttt{unclear}. Keys with values can have one parameter, such as \texttt{faction}, or two parameters, such as \texttt{speed leader}. In the latter case, the syntax is \texttt{key=\{value1\}\{value2\}}.
\item \texttt{location} is an optional coordinate or coordinate reference to place the symbol. This is generally needed when placing multiple symbols in one \texttt{tikzpicture}.
\item \texttt{name} is an optional reference label that acts just like the \texttt{name} property of a node in TikZ. It exposes standard rectangle node anchors such as \texttt{north} and \texttt{south}, allowing connectors to be drawn between symbols. This is useful when drawing organisation charts and similar (see Example \ref{}).
\item \texttt{label} is an optional text label that is added to the right of the symbol.
\end{itemize}

\subsubsection{Shared Keys}

\paragraph{\texttt{faction}}

\begin{table}[H]
\centering
\begin{tabular}{|c|s|s|s|s|@{}m{0pt}@{}}
\hline
\multirow{4}{*}{\thead{Command}} & \multicolumn{4}{c|}{\thead{Faction Frame}} \\ \cline{2-5}
& \thead{Friendly} & \thead{Hostile} & \thead{Neutral} & \thead{Unknown}&\\
\hline
\texttt{MilAir} + \texttt{MilMissile} & \tikz[baseline=-0.5ex]{\MilAir[faction=friendly]} & \tikz[baseline=-0.5ex]{\MilAir[faction=hostile]} & \tikz[baseline=-0.5ex]{\MilAir[faction=neutral]} & \tikz[baseline=-0.5ex]{\MilAir[faction=unknown]}&\\
[1.25cm]\hline
\texttt{MilLand} & \tikz[baseline=-0.5ex]{\MilLand[faction=friendly]} & \tikz[baseline=-0.5ex]{\MilLand[faction=hostile]} & \tikz[baseline=-0.5ex]{\MilLand[faction=neutral]} & \tikz[baseline=-0.5ex]{\MilLand[faction=unknown]}&\\
[1.25cm] \hline
\texttt{MilEquipment}* + \texttt{MilSeaSurface} & \tikz[baseline=-0.5ex]{\MilEquipment[faction=friendly]} & \tikz[baseline=-0.5ex]{\MilEquipment[faction=hostile]} & \tikz[baseline=-0.5ex]{\MilEquipment[faction=neutral]} & \tikz[baseline=-0.5ex]{\MilLand[faction=unknown]}&\\
[1.25cm] \hline
\texttt{MilInstallation} & \tikz[baseline=-0.5ex]{\MilInstallation[faction=friendly]} & \tikz[baseline=-0.5ex]{\MilInstallation[faction=hostile]} & \tikz[baseline=-0.5ex]{\MilInstallation[faction=neutral]} & \tikz[baseline=-0.5ex]{\MilInstallation[faction=unknown]}&\\
[1.25cm] \hline
\texttt{MilSeaSubsurface} + \texttt{MilMine}* & \tikz[baseline=-0.5ex]{\MilSeaSubsurface[faction=friendly]} & \tikz[baseline=-0.5ex]{\MilSeaSubsurface[faction=hostile]} & \tikz[baseline=-0.5ex]{\MilSeaSubsurface[faction=neutral]} & \tikz[baseline=-0.5ex]{\MilSeaSubsurface[faction=unknown]}&\\
[1.25cm] \hline
\texttt{MilSpace} & \tikz[baseline=-0.5ex]{\MilSpace[faction=friendly]} & \tikz[baseline=-0.5ex]{\MilSpace[faction=hostile]} & \tikz[baseline=-0.5ex]{\MilSpace[faction=neutral]} & \tikz[baseline=-0.5ex]{\MilSpace[faction=unknown]}&\\
[1.25cm] \hline
\texttt{MilActivity} & \tikz[baseline=-0.5ex]{\MilActivity[faction=friendly]} & \tikz[baseline=-0.5ex]{\MilActivity[faction=hostile]} & \tikz[baseline=-0.5ex]{\MilActivity[faction=neutral]} & \tikz[baseline=-0.5ex]{\MilActivity[faction=unknown]}&\\
[1.25cm] \hline
\end{tabular}
\begin{tablenotes}
\item \qquad  *Can be used without a frame using the \texttt{noframe} option.
\end{tablenotes}
\end{table}

\paragraph{\texttt{main}}

\paragraph{\texttt{upper}}

\paragraph{\texttt{lower}}

\paragraph{\texttt{frame status}}

\begin{figure}[H]
\centering
\begin{tikzpicture}
\matrix[column sep=5mm, row sep=5mm]{
\MilLand[faction=friendly, main=signal radio teletype centre, frame status=normal, scale=2] & \MilLand[faction=friendly, main=signal radio teletype centre, frame status=uncertain, scale=2] & \MilLand[faction=friendly, main=signal radio teletype centre, frame status=anticipated, scale=2]\\
\node{\texttt{frame status=normal}}; & \node{\texttt{frame status=unclear}}; & \node{\texttt{frame status=anticipated}}; \\
};
\end{tikzpicture}
\caption{Example of the \texttt{frame status} key in use.}
\end{figure}

\paragraph{\texttt{monochrome}}

\begin{figure}[H]
\centering
\begin{tikzpicture}
\matrix[column sep=5mm, row sep=5mm]{
\MilLand[faction=friendly, main=signal radio teletype centre, scale=2] & \MilLand[faction=friendly, main=signal radio teletype centre, monochrome, scale=2]\\
\node{normal}; & \node{\texttt{monochrome}}; \\
};
\end{tikzpicture}
\caption{Example of the \texttt{monochrome} key in use.}
\end{figure}

\paragraph{\texttt{scale}}

This allows you to scale the resulting symbol by a multiple. By default (\texttt{scale=1}) the boundary octagon is precisely 1cm in diameter.

\begin{figure}[H]
\centering
\begin{tikzpicture}
\matrix[column sep=5mm, row sep=5mm]{
\MilLand[faction=friendly, main=signal radio teletype centre, scale=0.5] & \MilLand[faction=friendly, main=signal radio teletype centre, scale=1] & \MilLand[faction=friendly,  main=signal radio teletype centre, scale=2]\\
\node{\texttt{scale=0.5}}; & \node{\texttt{scale=1}}; & \node{\texttt{scale=2}}; \\
};
\end{tikzpicture}
\caption{Example of the \texttt{scale} key in use.}
\end{figure}

\paragraph{\texttt{speed leader}}

\paragraph{\texttt{offset}, \texttt{movement}}

\subsection{Air Command (\textbf{\texttt{MilAir}})}

\subsubsection{Symbol Tables}

\paragraph{\texttt{Main}}
%\input{manual_scripts/Air_Main_table.tex}

\paragraph{\texttt{Upper}}
%\input{manual_scripts/Air_Upper_table.tex}

\paragraph{\texttt{Lower}}
%\input{manual_scripts/Air_Lower_table.tex}

\subsubsection{Additional Features}

\paragraph{Speed Leader}

\subsection{Missile Command (\textbf{\texttt{MilMissile}})}

\subsubsection{Symbol Tables}

\paragraph{\texttt{Left}}
%\input{manual_scripts/Missile_Left_table.tex}

\paragraph{\texttt{Right}}
%\input{manual_scripts/Missile_Right_table.tex}

\subsubsection{Additional Features}

\paragraph{Speed Leader}

\subsection{Land Command (\textbf{\texttt{MilLand}})}

\subsubsection{Icons and Modifiers}

\paragraph{\texttt{Main}}
%\input{manual_scripts/Land_Main_table.tex}

\paragraph{\texttt{Upper}}
%\input{manual_scripts/Land_Upper_table.tex}

\paragraph{\texttt{Lower}}
%\input{manual_scripts/Land_Lower_table.tex}

\subsection{Amplifiers}

\paragraph{Position and Movement}

\paragraph{Echelon}

\paragraph{Status}

\paragraph{Headquarters}

\paragraph{Grouping}

\paragraph{Supply Class}

\paragraph{Text Fields}

\subsection{Equipment Command (\textbf{\texttt{MilEquipment}})}

\subsubsection{Icons and Modifiers}

\paragraph{\texttt{Main}}
%\input{manual_scripts/Equipment_Main_table.tex}

\paragraph{\texttt{Mobility}}
%\input{manual_scripts/Equipment_Mobility_table.tex}

\subsection{Installation Command (\textbf{\texttt{MilInstallation}})}

\subsubsection{Icons and Modifiers}

\paragraph{\texttt{Main}}
%\input{manual_scripts/Installation_Main_table.tex}

\paragraph{\texttt{Upper}}
%\input{manual_scripts/Installation_Upper_table.tex}

\subsection{Sea Surface Command (\textbf{\texttt{MilSeaSurface}})}

\subsubsection{Icons and Modifiers}

\paragraph{\texttt{Main}}
%\input{manual_scripts/SeaSurface_Main_table.tex}

\paragraph{\texttt{Upper}}
%\input{manual_scripts/SeaSurface_Upper_table.tex}

\paragraph{\texttt{Lower}}
%\input{manual_scripts/SeaSurface_Lower_table.tex}

\subsubsection{Additional Features}

\paragraph{Speed Leader}

\subsection{Own Ship Command (\textbf{\texttt{OwnShip}})}

\subsection{Sea Subsurface Command (\textbf{\texttt{MilSeaSubsurface}})}

\subsubsection{Icons and Modifiers}

\paragraph{\texttt{Main}}
%\input{manual_scripts/SeaSubsurface_Main_table.tex}

\paragraph{\texttt{Upper}}
%\input{manual_scripts/SeaSubsurface_Upper_table.tex}

\paragraph{\texttt{Lower}}
%\input{manual_scripts/SeaSubsurface_Lower_table.tex}

\subsubsection{Additional Features}

\paragraph{Speed Leader}

\subsection{Sea Mine Command (\textbf{\texttt{MilMine}})}

\subsection{Space Command (\textbf{\texttt{MilSpace}})}

\subsubsection{Icons and Modifiers}

\paragraph{\texttt{Main}}
%\input{manual_scripts/Space_Main_table.tex}

\paragraph{\texttt{Upper}}
%\input{manual_scripts/Space_Upper_table.tex}

\paragraph{\texttt{Lower}}
%\input{manual_scripts/Space_Lower_table.tex}

\subsubsection{Additional Features}

\paragraph{Speed Leader}

\subsection{Space Debris Command (\textbf{\texttt{MilDebris}})}

\subsection{Activity Command (\textbf{\texttt{MilActivity}})}

\subsubsection{Symbol Tables}

\paragraph{\texttt{Main}}
%\input{manual_scripts/Activity_Main_table.tex}

\paragraph{\texttt{Upper}}
%\input{manual_scripts/Activity_Upper_table.tex}

\section{Custom Icons and Modifiers}

\subsection{\MilSymb TikZ Picture Directory Structure}

\begin{figure}[H]
\begin{forest}
  for tree={
    font=\ttfamily\footnotesize,
    grow'=0,
    child anchor=west,
    parent anchor=south,
    inner sep=0pt,
    anchor=west,
    calign=first,
    edge path={
      \noexpand\path [draw, \forestoption{edge}]
      (!u.south west) +(7.5pt,0) |- node[] {} (.child anchor)\forestoption{edge label};
    },
    before typesetting nodes={
      if n=1
        {insert before={[,phantom]}}
        {}
    },
    fit=band,
    before computing xy={l=15pt},
  }
[MilSymb
  [text
    [normal]
    [squashed]
    [small]
    [smallsquashed]
  ]
  [air
    [main\ldots]
    [upper\ldots]
    [lower\ldots]
  ]
   [land
    [main\ldots]
    [upper\ldots]
    [lower\ldots]
  ]
  [equipment
    [main\ldots]
    [mobility\ldots]
  ]
  [installation
    [main\ldots]
    [upper\ldots]
  ]
  [seasurface
    [main\ldots]
    [upper\ldots]
    [lower\ldots]
  ]
  [seasubsurface
    [main\ldots]
    [upper\ldots]
    [lower\ldots]
    [mine\ldots]
  ]
  [space
    [main\ldots]
    [upper\ldots]
    [lower\ldots]
  ]
  [activity
    [main\ldots]
    [upper\ldots]
  ]
    [multi
    [main\ldots]
    [upper\ldots]
    [lower\ldots]
    [upperlower\ldots]
  ]
  [supply\ldots]
  [custom\ldots]
]
\end{forest}

\end{figure}

To add a custom icon or modifier, create a TikZ \texttt{.pic} in the \texttt{custom} directory using \texttt{tikzset}:

\begin{writett}
\begin{verbatim}
\tikzset{
MilSymb custom/user icon/.pic={
  custom TikZ drawing commands go here...
} %comma after bracket is needed if defining multiple .pic.
}
\begin{tikzpicture}
  \MilLand[faction=hostile, main=user icon]
\end{tikzpicture}
\end{verbatim}
\end{writett}

You can also create your own sub directories, such as \texttt{custom/land/main/user icon}. This is recommended if you want to organise your custom shapes by symbol type and position.To use your icon or modifier in a command, simply use the path as the value for a icon or modifier key \texttt{\textbackslash MilLand[faction=friendly, main=path/to/user icon]}. The \texttt{main}, \texttt{upper} and \texttt{lower} keys all accept custom values, as well as the \texttt{left}, \texttt{right} and \texttt{mobility} keys where applicable.

\subsection{Drawing Bounds}

As specified in \DocLink, most icons and modifiers should fit within a template comprising of a regular octagon exactly \textbf{1} unit in width and \textbf{1} unit in height (with the exception of \textit{fullframe} icons and a few others). In commands that specify upper and lower modifiers, the \textbf{main} icon should not exceed a height of \textbf{0.2} units above and below its origin (the two horizontal dotted line in Figure \ref{octagon}). Similarly, the modifiers should also not extend into the area \textbf{0.2} units above and below the origin of the \textbf{main} icon. The key value \texttt{faction=none} on any \MilSymb command (apart from \texttt{OwnShip} or \texttt{MilDebris}, which do not have faction keys) will output this template instead of a frame.

\begin{figure}[H]
\centering
\begin{tikzpicture}
\MilLand[faction=none, scale=4](0,0)(frame)
\dimline[line style={arrows={Triangle}-{Triangle}}, extension start length=0.75, extension end length=0.75, extension end style={thin, black}, extension start style={thin, black}]{($(frame.north) + (3, 0)$)}{($(frame.south) + (3, 0)$)}{1}
\dimline[line style={arrows={Triangle}-{Triangle}}, extension start length=0.5, extension end length=0.5, extension end style={thin, black}, extension start style={thin, black}]{($(frame.north) + (2.5, -1.2)$)}{($(frame.south) + (2.5, 1.2)$)}{0.4}
\dimline[line style={arrows={Triangle}-{Triangle}}, extension start length=0.55, extension end length=0.55, extension end style={thin, black}, extension start style={thin, black}]{($(frame.north) + (2.5, 0)$)}{($(frame.center) + (2.5, 0.8)$)}{0.3}
\dimline[line style={arrows={Triangle}-{Triangle}}, extension start length=0.55, extension end length=0.55, extension end style={thin, black}, extension start style={thin, black}]{($(frame.center) + (2.5, -0.8)$)}{($(frame.south) + (2.5, 0)$)}{0.3}
%\node {Main Anchor};
\draw[red] plot[only marks, mark=*] coordinates{(0,0) (0, 1.36) (0,-1.36)};
\node[anchor=east, inner sep=5pt, color=red] at (0,0) {Main Origin (0,0)};
\node[anchor=east, inner sep=5pt, color=red] at (0,1.36) {Upper Origin (0,0.34)};
\node[anchor=east, inner sep=5pt, color=red] at (0,-1.36) {Lower Origin (0,-0.34)};
\end{tikzpicture}
\caption{Dimensions of the octagon and origins of the icon and modifiers.}
\label{octagon}
\end{figure}

For the \texttt{\textbf{MilMissile}} command, the template is rotated 90\textdegree anticlockwise, and the \texttt{left} and \texttt{right} keys correspond to the \texttt{upper} and \texttt{lower} keys respectively. The \texttt{mobility} origin is located \textbf{0.1} units below the \texttt{south} anchor of the frame.

\subsection{Border Anchors}

\MilSymb defines an anchored bounding box named \textbf{\texttt{M}} around all frames. This has anchor points identical to the \texttt{rectangle} node in TikZ. These can be used as coordinates for drawing icons and modifiers relative to the edge of the frame.

\subsection{Faction Variants}

Most \textit{fullframe} icons have slight variations depending on the faction frame that is being used. To facilitate this, you can create a set of four TikZ \texttt{.pic} in faction sub directories, like so:\\

\noindent\texttt{custom/user icon/friendly/.pic}\\
\texttt{custom/user icon/hostile/.pic}\\
\texttt{custom/user icon/neutral/.pic}\\
\texttt{custom/user icon/unknown/.pic}\\

Then, insert \texttt{/\textbackslash MilSymb@selectedfaction} directly after the \texttt{path/to/user icon} (so it forms \texttt{path/to/user icon/\textbackslash MilSymb@selectedfaction}). \texttt{\textbackslash MilSymb@selectedfaction} will be replaced by the name of the faction, and complete the path to the icon.

\subsection{Using Existing Icons and Modifiers}

\section{Control Measures}

Control Measures are planned to be included in the next major version of \textbf{\texttt{MilSymb}}. Please see the \href{https://github.com/ralphieraccoon/MilSymb}{GitHub} repository for further information.

\end{document}
